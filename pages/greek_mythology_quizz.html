<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>Greek mythology quizz</title>
	</head>
<body>
<h2>greek mythology quizz</h2>

<section>
</section>
<input type="text" id="textInput">
<button type="submit" id="click">submit</button>

<p id="yesNo"></p>

<img src="" id="image" height="200">
<p id="para"></p>
<a href="" id="wikipedia_link"></a>

<script>
		const section = document.querySelector('section');
		var dataURL = 'greek_myth_data.json';
		var score = 0;
		var button = document.getElementById("click");
		var yesOrNo = document.getElementById("yesNo");
		// makes variables that are used by the Wikipedia section
		var link = document.getElementById('wikipedia_link');
		var image = document.getElementById("image")
		var wikipediaPara = document.getElementById("para")
		var numberOfQues = 20;

		function randomNumFunc(maxi) {
			return Math.floor(Math.random() * maxi);
		}

		async function startAll() {
			let response = await fetch(dataURL);
			let caracters = await response.json();
			populateSection(caracters);
		}
		startAll();

		function populateSection(jsonObj) {
			var questions = 0;
			var randomCaracter = randomNumFunc(jsonObj.caracters.length);
			caracter = Object.getOwnPropertyNames(jsonObj['caracters'][randomCaracter])
			let randomRelation = caracter[randomNumFunc(caracter.length)];

			if(randomRelation === "name") {
				while(randomRelation === "name") {
					randomRelation = caracter[randomNumFunc(caracter.length)];

				}
			}

			var answer = jsonObj['caracters'][randomCaracter][randomRelation];
			var myPara = document.createElement('p');
			myPara.textContent = "Who is the " + randomRelation + " of " + jsonObj['caracters'][randomCaracter].name + "?";
			section.appendChild(myPara);
			function myFunc() {
				// creates a function to get the summary of the Wikipedia page corresponding to the answer.
				async function wikipedia() {
					// changes the url of element with the id "wikipedia_link" to a link to the Wikipedia page
					link.href = "https://en.wikipedia.org/wiki/" + answer[0];
					link.textContent = "Learn more about " + answer[0] + " on Wikipedia";
					// defines a variable for refering to the URL of the JSON file of the Wikipedia page.
    			let url = "https://en.wikipedia.org/api/rest_v1/page/summary/" + answer[0];
					let response = await fetch(url);
					let json = await response.json();
					// changes the paragraph with the id "para" to the first paragraph on the Wikipedia page
					wikipediaPara.innerHTML = json.extract_html;
					// changes the <img> to the first image from the Wikipedia page
					image.src = json.thumbnail.source;
  				}
			// calls the function we just created
			wikipedia()
				.catch(error => {
					console.log("error")
					console.error(error)
				});
			questions ++
			var txtBox = document.getElementById("textInput").value;
			// makes the answer case insensitive by turning the answer array to a string then putting it to lower case and then
			// putting it back to an array so the if function can read it
			var caseInsensitiveAnswer = answer.toString().toLowerCase().split(',');
			if(caseInsensitiveAnswer.includes(txtBox.toLowerCase())) {
					score ++;
					yesOrNo.innerHTML = "Bravo!<br>Your score is: " + score + "/" + questions;
				} else if(questions < numberOfQues) {
					yesOrNo.innerHTML = "The " + randomRelation + " of " + jsonObj['caracters'][randomCaracter].name + " is " + answer[0] + ". Try again. <br> Your score is: " + score + "/" + questions;
				} else {
					yesOrNo.innerHTML = "";
					// clears the image
					image.src = "";
					// clears the paragraph
					wikipediaPara.textContent = "";
					// sets the link to nothing
					link.textContent = ""
				}
				document.getElementById("textInput").value = '';
				document.getElementById("textInput").focus();

				if(questions < numberOfQues){
					randomCaracter = randomNumFunc(jsonObj.caracters.length);
					caracter = Object.getOwnPropertyNames(jsonObj['caracters'][randomCaracter]);
					randomRelation = caracter[randomNumFunc(caracter.length)];
					if(randomRelation === "name") {
						while(randomRelation === "name") {
							var randomRelation = caracter[randomNumFunc(caracter.length)];
						}
					}

					answer = jsonObj['caracters'][randomCaracter][randomRelation];

					oldPara = document.querySelector('p');
					var myPara = document.createElement('p');
					myPara.textContent = "Who is the " + randomRelation + " of " + jsonObj['caracters'][randomCaracter].name + "?";
				}
				else {
					oldPara = document.querySelector('p');
					var myPara = document.createElement('p');
					myPara.textContent = "You finished! You did " + score + " on " + numberOfQues;
				}
				section.replaceChild(myPara, oldPara);
				}
				input = document.getElementById("textInput");
				input.addEventListener("keyup", function(event) {
					if (event.keyCode === 13) {
 						event.preventDefault();
  					document.getElementById("click").click();
 					}
				});
			button.addEventListener("click", myFunc);
		}

		</script>
</body>
</html>
